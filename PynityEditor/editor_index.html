<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pynity Editor</title>
    <link rel="stylesheet" href="static/css/styles.css">
    <script type="module" src="static/js/three.module.js"></script>
    <script type="module" src="static/js/three.js"></script>
    <script type="module" src="static/js/TransformControls.js"></script>
    <script type="module" src="static/js/editor_combined_manager.js"></script>
</head>
<body>
    <div id="toolbar">
        <button id="saveBtn">Save</button>
        <button id="loadBtn">Load</button>
        <button id="addCubeBtn">Add Cube</button>
        <button id="addSphereBtn">Add Sphere</button>
        <button id="toggleEditModeBtn">Toggle Edit Mode</button>
        <button id="toggleGridBtn">Toggle Grid</button>
    </div>
    <div id="sidebar">
        <h2>Assets</h2>
        <ul>
            <li>Cube</li>
            <li>Sphere</li>
        </ul>
    </div>
    <div id="details">
        <h2>Details</h2>
        <div id="detailsContent"></div>
    </div>
    <div id="canvas-container">
        <canvas id="gameCanvas"></canvas>
    </div>
    <script type="module">
        import { EditorCameraManager, EditorControlsManager, EditorLevelsManager } from './static/js/editor_combined_manager.js';

        document.addEventListener('DOMContentLoaded', () => {
            console.log('DOM fully loaded and parsed');

            const canvas = document.getElementById('gameCanvas');
            const canvasContainer = document.getElementById('canvas-container');
            const renderer = new THREE.WebGLRenderer({ canvas });
            renderer.setSize(canvasContainer.clientWidth, canvasContainer.clientHeight);

            window.addEventListener('resize', () => {
                renderer.setSize(canvasContainer.clientWidth, canvasContainer.clientHeight);
                camera.aspect = canvasContainer.clientWidth / canvasContainer.clientHeight;
                camera.updateProjectionMatrix();
            });

            const scene = new THREE.Scene();
            console.log('Scene initialized');

            const cameraManager = new EditorCameraManager(75, canvasContainer.clientWidth / canvasContainer.clientHeight, 0.1, 1000, [0, 1.6, 5]);
            const camera = cameraManager.getCamera();
            console.log('CameraManager initialized');

            const levelsManager = new EditorLevelsManager(scene, camera, renderer);
            console.log('LevelsManager initialized');

            const controlsManager = new EditorControlsManager(camera);
            console.log('ControlsManager initialized');

            const light = new THREE.DirectionalLight(0xffffff, 1);
            light.position.set(5, 5, 5).normalize();
            scene.add(light);
            console.log('Light added to the scene');

            fetch('levels/universe.json')
                .then(response => response.json())
                .then(levelData => levelsManager.loadLevelData(levelData));

            function animate() {
                requestAnimationFrame(animate);
                controlsManager.updateCamera();
                renderer.render(scene, camera);
            }

            animate();

            document.getElementById('saveBtn').addEventListener('click', () => {
                console.log('Save button clicked');
            });

            document.getElementById('loadBtn').addEventListener('click', () => {
                console.log('Load button clicked');
            });

            document.getElementById('addCubeBtn').addEventListener('click', () => {
                console.log('Add Cube button clicked');
                levelsManager.addObject({
                    type: 'cube',
                    size: [1, 1, 1],
                    color: [1, 0, 0],
                    position: [0, 0, 0]
                });
            });

            document.getElementById('addSphereBtn').addEventListener('click', () => {
                console.log('Add Sphere button clicked');
                levelsManager.addObject({
                    type: 'sphere',
                    size: [0.5],
                    color: [0, 1, 0],
                    position: [2, 0, 0]
                });
            });

            document.getElementById('toggleEditModeBtn').addEventListener('click', () => {
                levelsManager.toggleEditMode();
            });

            document.getElementById('toggleGridBtn').addEventListener('click', () => {
                levelsManager.toggleGrid();
            });
        });
    </script>
</body>
</html>
