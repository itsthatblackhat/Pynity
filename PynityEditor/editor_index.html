<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pynity Editor</title>
    <link rel="stylesheet" href="static/css/styles.css">
    <script src="static/js/three.min.js"></script>
    <script type="module" src="static/js/editor_combined_manager.js"></script>
    <style>
        body, html {
            margin: 0;
            padding: 0;
            overflow: hidden;
            height: 100%;
            display: flex;
            flex-direction: column;
        }
        #toolbar {
            flex: 0 0 40px;
            background-color: #2f3e56;
            color: #fff;
            display: flex;
            justify-content: space-around;
            align-items: center;
        }
        #main {
            flex: 1;
            display: flex;
            overflow: hidden;
        }
        #sidebar, #details {
            flex: 0 0 200px;
            background-color: #2f3e56;
            color: #fff;
            overflow-y: auto;
        }
        #viewport {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: #fff;
        }
        #gameCanvas {
            display: block;
            width: 100%;
            height: 100%;
        }
    </style>
</head>
<body>
    <div id="toolbar">
        <button id="saveBtn">Save</button>
        <button id="loadBtn">Load</button>
        <button id="addCubeBtn">Add Cube</button>
        <button id="addSphereBtn">Add Sphere</button>
    </div>
    <div id="main">
        <div id="sidebar">
            <h2>Assets</h2>
            <ul>
                <li>Cube</li>
                <li>Sphere</li>
            </ul>
        </div>
        <div id="viewport">
            <canvas id="gameCanvas"></canvas>
        </div>
        <div id="details">
            <h2>Details</h2>
            <!-- Details of selected object will go here -->
        </div>
    </div>
    <script src="static/js/player_physics.js"></script>
    <script type="module">
        import { EditorCameraManager, EditorControlsManager, EditorLevelsManager } from './static/js/editor_combined_manager.js';

        document.addEventListener('DOMContentLoaded', () => {
            console.log('DOM fully loaded and parsed');

            const canvas = document.getElementById('gameCanvas');
            const viewport = document.getElementById('viewport');
            const renderer = new THREE.WebGLRenderer({ canvas });
            renderer.setSize(viewport.clientWidth, viewport.clientHeight);

            window.addEventListener('resize', () => {
                renderer.setSize(viewport.clientWidth, viewport.clientHeight);
                camera.aspect = viewport.clientWidth / viewport.clientHeight;
                camera.updateProjectionMatrix();
            });

            const scene = new THREE.Scene();
            console.log('Scene initialized');

            const cameraManager = new EditorCameraManager(75, viewport.clientWidth / viewport.clientHeight, 0.1, 1000, [0, 1.6, 5]);
            const camera = cameraManager.getCamera();
            console.log('CameraManager initialized');

            const levelsManager = new EditorLevelsManager(scene);
            console.log('LevelsManager initialized');

            const controlsManager = new EditorControlsManager(camera);
            console.log('ControlsManager initialized');

            // Add basic lighting to the scene
            const light = new THREE.DirectionalLight(0xffffff, 1);
            light.position.set(5, 5, 5).normalize();
            scene.add(light);
            console.log('Light added to the scene');

            // Example level data to ensure something is rendered
            const levelData = {
                objects: [
                    { type: 'cube', size: [1, 1, 1], color: [1, 0, 0], position: [0, 0, 0], name: 'Cube1' },
                    { type: 'sphere', size: [1], color: [0, 1, 0], position: [2, 0, 0], name: 'Sphere1' }
                ]
            };

            levelsManager.loadLevelData(levelData);

            function animate() {
                requestAnimationFrame(animate);
                controlsManager.updateCamera();
                renderer.render(scene, camera);
                console.log('Scene rendered');
            }

            animate();

            // Event listeners for buttons
            document.getElementById('saveBtn').addEventListener('click', () => {
                console.log('Save button clicked');
                // Implement save logic
            });

            document.getElementById('loadBtn').addEventListener('click', () => {
                console.log('Load button clicked');
                // Implement load logic
            });

            document.getElementById('addCubeBtn').addEventListener('click', () => {
                console.log('Add Cube button clicked');
                // Implement add cube logic
            });

            document.getElementById('addSphereBtn').addEventListener('click', () => {
                console.log('Add Sphere button clicked');
                // Implement add sphere logic
            });
        });
    </script>
</body>
</html>
